javascript:void function(t){var e=function(t){function e(){var t,e,o=document.createElement("div");for(t=0;t<m.length;t  )if(e=m[t],o.style.setProperty(e "transform","rotate(1rad) scaleX(2)",null),o.style.getPropertyValue(e "transform"))return f=e "transform",void(p=e "transform-origin");throw alert("Your browser doesn't support CSS tranforms!"),"Your browser doesn't support CSS tranforms!"}function o(t,e,o,n,i){var a,r;return t<i.left?(a=i.left-t,e<i.top?(r=i.top-e,n>=a*a r*r):e<=i.bottom?o>=a:(r=e-i.bottom,n>=a*a r*r)):t<=i.right?e<i.top?i.top-e<=o:e<=i.bottom?!0:e-i.bottom<=o:(a=t-i.right,e<i.top?(r=i.top-e,n>=a*a r*r):e<=i.bottom?o>=a:(r=e-i.bottom,n>=a*a r*r))}function n(t,e,o){var n;return t<o.left?(n=o.left-t,e<o.top?[o.left,o.top]:e<=o.bottom?[o.left,e]:[o.left,o.bottom]):t<=o.right?e<o.top?[t,o.top]:e<=o.bottom?[t,e]:[t,o.bottom]:(n=t-o.right,e<o.top?[o.right,o.top]:e<=o.bottom?[o.right,e]:[o.right,o.bottom])}function i(t){return t.w*t.h*Math.min(t.w,t.h)}function a(){function t(t){void 0!==t&&null!==t&&(t.khIgnore=!0,t.style.border=u,n.push(t))}function e(t){var e;for(e=0;e<t.arrs.length;e  )t.arrs[e][t.idxs[e]]=void 0;t.el.style.visibility="hidden",t.el.khPicked=!0,delete t.arrs,delete t.idxs}var n=[],i=[],a=100,r=100,l={a:1,b:1,big:1,body:1,cite:1,code:1,dd:1,div:1,dt:1,em:1,font:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,label:1,legend:1,li:1,p:1,pre:1,small:1,span:1,strong:1,sub:1,sup:1,td:1,th:1,tt:1};this.addDomNode=t,this.addWords=function(e){function o(t){return t.tagName&&l[t.tagName.toLowerCase()]}function n(t,e){var i,r;if(e&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.trim().length>0)return void a.push(t);if(t.childNodes&&!t.khIgnore)for(e=o(t),i=0,r=t.childNodes.length;r>i;i  )n(t.childNodes[i],e)}function i(e){var o,n,i=e.parentNode,a=e.nodeValue.split(/\s /),r=e.nodeValue.split(/\S /),l=Math.max(a.length,r.length);for(r.length>0&&0===r[0].length&&r.shift(),o=0;l>o;o  )o<a.length&&a[o].length>0&&(n=document.createElement("span"),n.innerHTML=a[o],i.insertBefore(n,e),t(n)),o<r.length&&r[o].length>0&&(n=document.createTextNode(r[o]),i.insertBefore(n,e));i.removeChild(e)}var a=[];n(e,o(e)),a.map(i)},this.addTagNames=function(e,o){var n,i,a,r,l=e.tagName&&e.tagName.toLowerCase();if(!e.khIgnore&&(-1!==o.indexOf(l)&&t(e),e.getElementsByTagName))for(n=0;n<o.length;n  )for(a=e.getElementsByTagName(o[n]),i=0,r=a.length;r>i;i  )a[i].khIgnore||t(a[i])},this.finalize=function(t,e){var o,l,s,c,d,h,u,f,p,m,g,v=Math.floor(t/a) 1,y=Math.floor(e/r) 1;for(i=new Array(v),o=0;v>o;o  )i[o]=new Array(y);for(s=0,c=n.length;c>s;s  )if(u=n[s],!u.khPicked)for(p=jQuery(u).offset(),m=jQuery(u).width(),g=jQuery(u).height(),f={el:n[s],left:p.left,right:p.left m,top:p.top,bottom:p.top g,w:m,h:g,x:p.left m/2,y:p.top g/2,diag:Math.sqrt((m*m g*g)/4),arrs:[],idxs:[]},d=Math.floor(f.left/a),h=Math.floor(f.top/r),v=Math.floor((f.left f.w)/a) 1,y=Math.floor((f.top f.h)/r) 1,o=d;v>o;o  )for(l=h;y>l;l  )void 0===i[o]&&(i[o]=[]),void 0===i[o][l]?i[o][l]=[f]:i[o][l].push(f),f.arrs.push(i[o][l]),f.idxs.push(i[o][l].length-1)},this.removeIntersecting=function(t,n,l,s){var c,d,h,u,f,p=l*l,m=Math.floor((t-l)/a),g=Math.floor((n-l)/r),v=Math.floor((t l)/a) 1,y=Math.floor((n l)/r) 1;for(c=m;v>c;c  )if(void 0!==i[c])for(d=g;y>d;d  )if(h=i[c][d],void 0!==h)for(u=0;u<h.length;u  )f=h[u],void 0!==f&&o(t,n,l,p,f)&&s(f)&&e(f)}}function r(t,e,o,a){function r(){return 4*Math.PI*w*w*w/3}function l(t){var e=r() i(t)*S;w=Math.pow(3*e/(4*Math.PI),1/3)}function s(t){var e=n(y,b,t),o=e[0]-y,i=e[1]-b,r=Math.sqrt(o*o i*i),s=0-Q,c=e[0]-t.left,d=e[1]-t.top,h=Math.atan2(i,o)-Q,u=r*Math.cos(h),f=r*Math.sin(h),g=t.el.cloneNode(!0),v=jQuery(t.el),M={el:g,attX:u,attY:f,attT:"translate(" Math.round(u) "px," Math.round(f) "px) rotate(" s "rad)",r:r,offTh:h,offPhi:0-B,diag:t.diag,removeR:r t.diag,visible:!1,display:v.css("display")};I.push(M),l(t),g.style.position="absolute",g.style.left=-c "px",g.style.top=-d "px",g.style.setProperty(p,c "px " d "px",null),g.style.display="none",g.style.color=v.css("color"),g.style.textDecoration=v.css("text-decoration"),g.style.fontSize=v.css("font-size"),g.style.fontWeight=v.css("font-weight"),g.khIgnore=!0,m.appendChild(g),a&&a.play_pop()}function c(t){return A&&i(t)>r()?!1:(s(t),!0)}function d(){var t,e,o,n,i,a,r,l,s,c,d;for(g.style.left=y-w "px",g.style.top=b-w "px",w!=x&&(g.width=2*w 1,g.height=2*w 1,x=w),v.clearRect(0,0,2*w,2*w),v.fillStyle="#fff",v.beginPath(),v.arc(w,w,w-1,0,2*Math.PI,!0),v.fill(),v.strokeStyle=C,v.beginPath(),v.arc(w,w,w-1,0,2*Math.PI,!0),v.stroke(),v.fillStyle=C,t=w w*Math.cos(Q Math.PI/16),e=w w*Math.sin(Q Math.PI/16),o=w w*Math.cos(Q-Math.PI/16),n=w w*Math.sin(Q-Math.PI/16),i=w w*Math.cos(Q 15*Math.PI/16)-t,a=w w*Math.sin(Q 15*Math.PI/16)-e,r=0;r<2*Math.PI;r =Math.PI/7)l=(-Math.cos(B r) 1)/2,s=(-Math.cos(B r Math.PI/32) 1)/2,c=Math.sin(B r),d=Math.sin(B r Math.PI/32),c>0&&d>0&&(v.beginPath(),v.moveTo(t l*i,e l*a),v.lineTo(t s*i,e s*a),v.lineTo(o s*i,n s*a),v.lineTo(o l*i,n l*a),v.fill())}function h(t){var e=Q t.offTh,o=B t.offPhi,n=t.r*Math.cos(e),i=t.r*Math.sin(e),a=t.r*Math.cos(Q-t.offTh Math.PI)-n,r=t.r*Math.sin(Q-t.offTh Math.PI)-i,l=(-Math.cos(o) 1)/2,s=n l*a,c=i l*r,d=t.r*Math.sin(o);return 0>d&&Math.sqrt(s*s c*c) t.diag<w?(t.visible&&(t.visible=!1,t.el.style.display="none"),!1):(t.visible||(t.visible=!0,t.el.style.display=t.display),t.el.style.zIndex=d>0?501:499,t.el.style.setProperty(f,"translate(" y "px," b "px) rotate(" Q "rad) scaleX(" Math.cos(o) ") " t.attT,null),!0)}function u(t){m.removeChild(t.el),delete t.el}var m,g,v,y=300,b=300,M=0,k=0,w=20,x=0,T=1e4,E=1e4,I=[],C=o.color,P=0,j=0,N=!1,S=o.VOL_MULT,L=o.MAX_ATTACHED_VISIBLE,A=o.CHECK_VOLS,Q=0,B=0;this.init=function(){g=document.createElement("canvas"),g.width=2*w,g.height=2*w,g.style.cssText="position: absolute; z-index: 500;",t.appendChild(g),v=g.getContext("2d"),m=document.createElement("div"),t.appendChild(m)},this.setRadius=function(t){w=t},this.getState=function(){return{x:y,y:b,vx:M,vy:k,radius:w,th:Q,phi:B}},this.setState=function(t){y=t.x,b=t.y,M=t.vx,k=t.vy,w=t.radius,Q=t.th,B=t.phi},this.setXY=function(t,e){y=t,b=e},this.setTh=function(t){Q=t},this.setPhi=function(t){B=t},this.setColor=function(t){C=t},this.setDocSize=function(t,e){T=t,E=e},this.setAccel=function(t){N=t},this.setAccelTarget=function(t,e){P=t,j=e},this.updatePhysics=function(){var t,o,n,i=y,r=b,l=!1;N?(n=Math.atan2(j-b,P-y),M =.5*Math.cos(n),k =.5*Math.sin(n)):(M*=.95,k*=.95),y =M,b =k,0>y-w?(l=!0,y=w 1,M=-M):y w>T&&(l=!0,y=T-w-1,M=-M),0>b-w?(l=!0,b=w 1,k=-k):b w>E&&(l=!0,b=E-w-1,k=-k),(0!==M||0!==k)&&(Q=Math.atan2(k,M),t=y-i,o=b-r,B-=Math.sqrt(t*t o*o)/w),e.removeIntersecting(y,b,w,c),this.draw(),l&&a&&a.play_bounce()},this.draw=function(){var t,e,o=0;for(d(),t=I.length;--t>=0;)if(e=I[t],e.removeR<w)I.splice(t,1).map(u);else if(h(e)&&  o>L){I.splice(0,t).map(u);break}}}function l(t){return t.preventDefault(),t.returnValue=!1,!1}function s(t,e,o){function n(){i.setDocSize(jQuery(document).width()-5,jQuery(document).height()-5)}var e,i,a,s;i=new r(t,e,o,!1),i.init(),i.setXY(300,300),window.scrollTo(0,200),n(),document.addEventListener("touchstart",function(t){return 1===t.touches.length?(i.setAccel(!0),l(t)):void 0},!0),document.addEventListener("touchmove",function(t){i.setAccelTarget(t.touches[0].pageX,t.touches[0].pageY)},!0),document.addEventListener("touchend",function(t){return 0===t.touches.length?(i.setAccel(!1),l(t)):void 0},!0),-5!==o.MOUSEB&&(document.addEventListener("mousemove",function(t){i.setAccelTarget(t.pageX,t.pageY)},!0),document.addEventListener("mousedown",function(t){return t.button===o.MOUSEB?(i.setAccel(!0),l(t)):void 0},!0),document.addEventListener("mouseup",function(t){return t.button===o.MOUSEB?(i.setAccel(!1),l(t)):void 0},!0),0===o.MOUSEB?document.addEventListener("click",function(t){return 0===t.button?l(t):void 0},!0):2===o.MOUSEB&&document.addEventListener("contextmenu",l,!0)),a=setInterval(function(){i.updatePhysics()},25),s=setInterval(n,1e3)}function c(t,e,o){o.finalize(jQuery(document).width(),jQuery(document).height()),jQuery("#loadingp").empty(),jQuery("<button>Start!</button>").click(function(){var n,i,a;jQuery("#bgmusicc").attr("checked")&&((i=document.getElementById("khbgmusic"))||(i=document.createElement("audio"),i.id="khbgmusic",i.loop="loop",i.src="http://kathack.com/js/katamari.mp3",t.appendChild(i)),i.play()),a={color:jQuery("#khcolor").val(),VOL_MULT:parseFloat(jQuery("#vol_mult").val()),MAX_ATTACHED_VISIBLE:parseInt(jQuery("#maxAtt").val(),10),CHECK_VOLS:jQuery("#checkv").attr("checked")?!0:!1,MOUSEB:parseInt(jQuery("#mouseb").val(),10)},t.removeChild(e),n=new s(t,o,a)}).appendTo("#loadingp")}function d(t){var e=document.createElement("div");return e.style.cssText="position: fixed;left: 50%;top: 50%;width: 400px;margin-left:-200px;margin-top:-150px;border:1px solid black;background-color:white;color:black;padding:20px;font-size:13px;text-align:left;z-index:501;",e.innerHTML='<h1 style="font-size:16pt"><a href="http://kathack.com/" style="color:blue;text-decoration:none;">Katamari!</a></h1><button style="position:absolute;top:0;right:0;">X</button><p>Controls: Hold down <b><select id="mouseb"><option value="0">Left-Click</option><option value="2" selected="selected">Right-Click</option><option value="-5">Touch</option></select></b> to control the ball!</p><div><label>Background Music? <input id="bgmusicc" type="checkbox" checked="checked" /></label></div><div style="text-align:right; color:gray;"><label>Katamari Color: <select id="khcolor"><option value="#ff0000" style="background-color:#ff0000;color:#ff0000"> r </option><option value="#00ff00" style="background-color:#00ff00;color:#00ff00"> g </option><option value="#0000ff" style="background-color:#0000ff;color:#0000ff"> b </option><option selected="selected" value="#7D26CD" style="background-color:#7D26CD;color:#7D26CD"> p </option></select></label><br /> <label title="Lower this if the game gets slow.">Max Attached Objects: <select id="maxAtt"><option>25</option><option>50</option><option selected="selected">75</option><option>100</option><option>9000</option></select></label><br /><label title="How much to grow when an object is picked up.">Growth Speed: <input id="vol_mult" type="text" size="6" value="1.0" /></label><br /><label title="Bigger objects require a bigger katamari to pick up.">Realistic Pickups? <input id="checkv" type="checkbox" checked="checked" /></label></div><p id="loadingp">Loading!</p>',t.appendChild(e),e.getElementsByTagName("button")[0].addEventListener("click",function(){t.removeChild(e)},!0),e}function h(){var t,e,o;t=document.createElement("div"),t.khIgnore=!0,document.body.appendChild(t),o=d(t),setTimeout(function(){var n,i,a;for(window.khNodes.addWords(document.body),n=0,i=document.body.childNodes.length;i>n;n  )a=document.body.childNodes[n],window.khNodes.addTagNames(a,["button","canvas","iframe","img","input","select","textarea"]);e=setInterval(function(){window.jQuery&&(clearInterval(e),c(t,o,window.khNodes))},100)},0)}var u="1px solid #bbb",f=null,p=null,m=["-webkit-","-moz-","-o-","-ms-",""],g=!1;window.khNodes||(g=!0,window.khNodes=new a),e(),window.noMain||h()},o=t&&t.fn&&parseFloat(t.fn.jquery)>=1.7;if(o)e(t);else{var n=document.createElement("script");n.src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.js",n.onload=n.onreadystatechange=function(){var t=this.readyState;t&&"loaded"!==t&&"complete"!==t||e(jQuery.noConflict())}}document.getElementsByTagName("head")[0].appendChild(n)}(window.jQuery);
